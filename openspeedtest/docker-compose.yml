###########################################################################
# AUTHOR:  aemcomtech.au
# VERSION: 1.2026.02.10.170845
# WEBSITE: aemcomtech.au
# PURPOSE: Secure a Docker-centric homelab repository by excluding sensitive 
#          environment variables, local database binaries, and platform-specific 
#          build artifacts.
###########################################################################
# Service: OpenSpeedTest
# Role: Network Performance & Diagnostics
# Security Level: Authenticated
# Standard: ISO/IEC 27001 (InfoSec)
###########################################################################

services:
  speedtest:
    image: openspeedtest/latest
    container_name: openspeedtest
    restart: unless-stopped
    hostname: openspeedtest
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    networks:
      ${YOUR_NETWORK_1}:
        aliases:
          - speedtest
    
    # --- Ports ---
    ports:
      - "${SPEEDTEST_PORT}:3000"

    # --- Resources ---
    # Performance is critical for accurate testing
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 128M

    # --- Healthcheck ---
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--spider", "http://localhost:3000"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  ${YOUR_NETWORK_1}:
    external: true